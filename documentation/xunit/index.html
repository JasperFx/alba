<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta name="generator" content="Bootply" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <title>Alba - Integrating Alba with xUnit.Net</title>
        <link href="/alba/content/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/alba/content/prism.css" rel="stylesheet" type="text/css" />
        <link href="/alba/content/theme.css" rel="stylesheet" type="text/css" />

        <link rel="apple-touch-icon" href="/bootstrap/img/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/bootstrap/img/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/bootstrap/img/apple-touch-icon-114x114.png">

        <link href="/alba/content/affix.css" rel="stylesheet" type="text/css" />
    </head>

    <body>

      <a href="https://github.com/jasperfx/Alba"><img style="z-index: 5000; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

      <nav class="navbar navbar-default navbar-fixed-top" role="banner">
      <div class="container">
        <div class="navbar-header">
          <a href="/alba" class="navbar-brand">Alba</a>
        </div>
        <nav class="collapse navbar-collapse" role="navigation">
          <ul class="nav navbar-nav pull-right">
            <li>
              <a href="/alba/getting_started">Getting Started</a>
            </li>
            <li>
              <a href="/alba/documentation">Documentation</a>
            </li>
            <li>
              <a href="https://gitter.im/jasperfx/Alba?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/jasperfx/Alba" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a>
            </li>
            <li><a href="/alba/documentation/bootstrapping" title="Bootstrapping and Configuration">Previous</a></li>
            <li><a href="/alba/documentation/urls" title="Working with Url's">Next</a></li>
          </ul>
          <div class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input id="search" type="search" class="form-control" placeholder="Search">
            </div>
          </div>

        </nav>

      </div>
    </nav>

    <div class="container">
      <nav class="navbar-inverse">
        <ol class="breadcrumb"><li><a href="/alba/">Alba</a></li><li><a href="/alba/documentation">Documentation</a></li><li class="active">Integrating Alba with xUnit.Net</li></ol>
      </nav>
    </div>

    <!--main-->
    <div class="container">
      <div class="row">
          <!--left-->
          <div class="col-md-3" id="leftCol">
            <h3>Alba 3.0.0</h3>
            <br />

            <ul class="nav nav-stacked affix" id="sidebar">
            </ul>

            <h3 class="no-margin">Next</h3><p><a href="/alba/documentation/urls">Working with Url's</a></p>
            <h3 class="no-margin">Previous</h3><a href="/alba/documentation/bootstrapping">Bootstrapping and Configuration</a></p>
          </div><!--/left-->

          <!--right-->
          <div class="col-md-9">
              <h1>Integrating Alba with xUnit.Net</h1>

              <hr />

              <div id="main-pane">
                <!--title: Integrating Alba with xUnit.Net-->
<div class="alert-info alert"><p><strong>Note!</strong>
While this is using xUnit.Net, the mechanics should be similar for other unit test frameworks. The key point is just to share the
hosted application test between tests while still cleaning up after yourself when you're done.</p>
</div>
<p>If you are writing only a few Alba specifications in your testing project and your application spins up very quickly, you can just happily write tests like this:</p>
<pre><code class="language-csharp">&#xA;[Fact]&#xA;public async Task should_say_hello_world()&#xA;{&#xA;    using (var system = SystemUnderTest.ForStartup&lt;Startup&gt;())&#xA;    {&#xA;        // This runs an HTTP request and makes an assertion&#xA;        // about the expected content of the response&#xA;        await system.Scenario(_ =&gt;&#xA;        {&#xA;            _.Get.Url(&quot;/&quot;);&#xA;            _.ContentShouldBe(&quot;Hello, World!&quot;);&#xA;            _.StatusCodeShouldBeOk();&#xA;        });&#xA;    }&#xA;}&#xA;</code></pre>
<p>Do note that your <code>[Fact]</code> method needs to be declared as <code>async Task</code> to ensure that xUnit finishes the specification before disposing the system or
you'll get <em>unusual</em> behavior. Also note that you really need to dispose the <code>SystemUnderTest</code> to shut down your application and dispose any internal services that might be holding on to computer resources.</p>
<p>If your application startup time becomes a performance problem, and especially in larger test suites, you probably want to share the <code>SystemUnderTest</code> object between tests. xUnit helpfully provides the <a href="https://xunit.github.io/docs/shared-context">class fixture feature</a> for just this use case.</p>
<p>In this case, build out your <code>SystemUnderTest</code> in a class like this:</p>
<pre><code class="language-csharp">&#xA;public class WebAppFixture : IDisposable&#xA;{&#xA;    public readonly SystemUnderTest SystemUnderTest = SystemUnderTest.ForStartup&lt;WebApp.Startup&gt;();&#xA;&#xA;    public void Dispose()&#xA;    {&#xA;        SystemUnderTest?.Dispose();&#xA;    }&#xA;}&#xA;</code></pre>
<p>Then in your actual xUnit fixture classes, implement the <code>IClassFixture&lt;T&gt;</code> class like this:</p>
<pre><code class="language-csharp">&#xA;public class ContractTestWithAlba : IClassFixture&lt;WebAppFixture&gt;&#xA;{&#xA;    public ContractTestWithAlba(WebAppFixture app)&#xA;    {&#xA;        _system = app.SystemUnderTest;&#xA;    }&#xA;&#xA;    private readonly SystemUnderTest _system;&#xA;</code></pre>

              </div>

              <hr />

              <nav>
                <span>
                  <strong>Previous: </strong><a href="/alba/documentation/bootstrapping">Bootstrapping and Configuration</a>

                </span>
                <span class="pull-right">

                  <strong>Next: </strong><a href="/alba/documentation/urls">Working with Url's</a>

                </span>
              </nav>

          </div><!--/right-->
        </div><!--/row-->
      </div><!--/container-->

    </body>


    <footer>
        <script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type='text/javascript' src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="/alba/content/prism.js"></script>
        <script type="text/javascript" src="/alba/content/sidebar.js"></script>
        <script type="text/javascript" src="/alba/content/affix.js"></script>

<script>
$('#search').keyup(function(e){
  if(e.keyCode == 13) {
    var search = $('#search').val();

    var url = 'https://www.google.com/#q=site:jasperfx.github.io ' + search;
    url = encodeURI(url);

    window.location.href = url;

    e.stopPropagation();
    if (e.cancelBubble!=null) e.cancelBubble = true;
    return false;
  }
});
</script>
    </footer>
</html>
