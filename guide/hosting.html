<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Bootstrapping and Configuration | Alba</title>
    <meta name="description" content="Supercharged integration testing for ASP.Net Core web services">
    <link rel="stylesheet" href="/alba/assets/style.41ec4b9e.css">
    <link rel="modulepreload" href="/alba/assets/Home.9d4e9d90.js">
    <link rel="modulepreload" href="/alba/assets/AlgoliaSearchBox.23bc7f6a.js">
    <link rel="modulepreload" href="/alba/assets/app.3865ee6a.js">
    <link rel="modulepreload" href="/alba/assets/guide_hosting.md.3dc25292.lean.js">
    <link rel="modulepreload" href="/alba/assets/app.3865ee6a.js">
    <meta name="twitter:title" content="Bootstrapping and Configuration | Alba">
    <meta property="og:title" content="Bootstrapping and Configuration | Alba">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/alba/" aria-label="Alba, back to home" data-v-675d8756 data-v-4a583abe><!----> Alba</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/alba/guide/" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://gitter.im/JasperFx/alba?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Gitter | Join Chat <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://github.com/JasperFx/alba" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/alba/guide/" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://gitter.im/JasperFx/alba?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Gitter | Join Chat <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://github.com/JasperFx/alba" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/">Getting Started</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item active" href="/alba/guide/hosting">Working with AlbaHost</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#initializing-albahost">Initializing AlbaHost</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#running-a-scenario">Running a Scenario</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#customizing-the-system-for-testing">Customizing the System for Testing</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/xunit">Integrating with xUnit.Net</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/nunit">Integrating with NUnit</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/extensions">Extension Model</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/security">Security Extensions</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/">Scenario Testing</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/setup">Set up and tear down actions</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/urls">Specifying Urls</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/statuscode">HTTP Status Codes</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/headers">HTTP Headers</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/json">Json Web Services</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/xml">Xml Web Services</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/text">Plain Text Web Services</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/assertions">Custom Assertions</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/redirects">Redirects</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="bootstrapping-and-configuration"><a class="header-anchor" href="#bootstrapping-and-configuration" aria-hidden="true">#</a> Bootstrapping and Configuration</h1><h2 id="initializing-albahost"><a class="header-anchor" href="#initializing-albahost" aria-hidden="true">#</a> Initializing AlbaHost</h2><p>To get started with Alba, just add a Nuget reference to the Alba library to your testing project. In the following sections I&#39;ll show you how to bootstrap your <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core system with Alba and start authoring specifications with the <code>IAlbaHost</code> abstraction.</p><p>To bootstrap and connect any <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core application to Alba, create a <code>AlbaHost</code> using the definition of your <code>IHostBuilder</code> as shown below:</p><!-- snippet: sample_Quickstart3 --><p><a id="snippet-sample_quickstart3"></a></p><div class="language-cs"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">build_host_from_Program</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    
<span class="token punctuation">{</span>
    <span class="token comment">// Bootstrap your application just as your real application does</span>
    <span class="token class-name"><span class="token keyword">var</span></span> hostBuilder <span class="token operator">=</span> Program<span class="token punctuation">.</span><span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Empty</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> host <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AlbaHost</span><span class="token punctuation">(</span>hostBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Just as a sample, I&#39;ll run a scenario against</span>
    <span class="token comment">// a &quot;hello, world&quot; application&#39;s root url</span>
    <span class="token keyword">await</span> host<span class="token punctuation">.</span><span class="token function">Scenario</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span>Get<span class="token punctuation">.</span><span class="token function">Url</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s<span class="token punctuation">.</span><span class="token function">ContentShouldBe</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/Alba.Testing/Samples/Quickstart3.cs#L15-L32" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_quickstart3" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>There are both synchronous and asynchronous methods to bootstrap an <code>AlbaHost</code>. Depending on your test harness, I recommend using the asynchronous version whenever applicable.</p></div><p>Or alternatively, you can use one of the Alba extension methods off of <code>IHostBuilder</code> to start an <code>AlbaHost</code> object in a fluent interface style:</p><!-- snippet: sample_shorthand_bootstrapping --><p><a id="snippet-sample_shorthand_bootstrapping"></a></p><div class="language-cs"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">fluent_interface_bootstrapping</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    
<span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> host <span class="token operator">=</span> <span class="token keyword">await</span> Program
        <span class="token punctuation">.</span><span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Empty</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">StartAlbaAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Just as a sample, I&#39;ll run a scenario against</span>
    <span class="token comment">// a &quot;hello, world&quot; application&#39;s root url</span>
    <span class="token keyword">await</span> host<span class="token punctuation">.</span><span class="token function">Scenario</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span>Get<span class="token punctuation">.</span><span class="token function">Url</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s<span class="token punctuation">.</span><span class="token function">ContentShouldBe</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/Alba.Testing/Samples/Quickstart3.cs#L35-L51" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_shorthand_bootstrapping" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>The <code>AlbaHost</code> is an extension of the standard .Net Core <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.hosting.ihost?view=dotnet-plat-ext-5.0" target="_blank" rel="noopener noreferrer">IHost</a> interface with a few additions for testing support. While you can always access the underlying <code>TestServer</code> through the <code>IAlbaHost.Server</code> property, you&#39;re mostly going to be using the <code>Scenario()</code> method to write Alba &quot;Scenario&quot; tests.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>To make the samples in this page easier to follow, I&#39;m bootstrapping the <code>IAlbaHost</code> within each test. In real usage, bootstrapping your application is expensive and you will probably want to reuse the <code>IAlbaHost</code> between tests. See the integrations with NUnit and <a href="http://xUnit.Net" target="_blank" rel="noopener noreferrer">xUnit.Net</a> for examples.</p></div><h2 id="running-a-scenario"><a class="header-anchor" href="#running-a-scenario" aria-hidden="true">#</a> Running a Scenario</h2><p>Once you have a <code>AlbaHost</code> object, you&#39;re ready to execute <em>Scenario&#39;s</em> through your system inside of tests. Below is a scenario for the &quot;hello, world&quot; application:</p><!-- snippet: sample_should_say_hello_world --><p><a id="snippet-sample_should_say_hello_world"></a></p><div class="language-cs"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">should_say_hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> host <span class="token operator">=</span> <span class="token keyword">await</span> Program
        <span class="token punctuation">.</span><span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Empty</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment">// This extension method is just a shorter version</span>
        <span class="token comment">// of new AlbaHost(builder)</span>
        <span class="token punctuation">.</span><span class="token function">StartAlbaAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// This runs an HTTP request and makes an assertion</span>
    <span class="token comment">// about the expected content of the response</span>
    <span class="token keyword">await</span> host<span class="token punctuation">.</span><span class="token function">Scenario</span><span class="token punctuation">(</span>_ <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        _<span class="token punctuation">.</span>Get<span class="token punctuation">.</span><span class="token function">Url</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _<span class="token punctuation">.</span><span class="token function">ContentShouldBe</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _<span class="token punctuation">.</span><span class="token function">StatusCodeShouldBeOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/Alba.Testing/Samples/Quickstart.cs#L30-L50" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_should_say_hello_world" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>The single <code>Action&lt;Scenario&gt;</code> argument should completely configure the <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> <code>HttpContext</code> for the request and apply any of the declarative response assertions. The actual HTTP request happens inside of the <code>Scenario()</code> method. The response contains the raw <code>HttpContext</code> and several helper methods to help you parse or read information from the response body:</p><!-- snippet: sample_IScenarioResult --><p><a id="snippet-sample_iscenarioresult"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IScenarioResult</span>
<span class="token punctuation">{</span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">///     Helpers to interrogate or read the HttpResponse.Body</span>
    <span class="token comment">///     of the request</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token punctuation">[</span><span class="token function">Obsolete</span><span class="token punctuation">(</span><span class="token string">&quot;Use the methods directly on IScenarioResult instead&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token return-type class-name">HttpResponseBody</span> ResponseBody <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">///     The raw HttpContext used during the scenario</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token return-type class-name">HttpContext</span> Context <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Read the contents of the HttpResponse.Body as text</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">ReadAsText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Read the contents of the HttpResponse.Body into an XmlDocument object</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
    <span class="token return-type class-name">XmlDocument<span class="token punctuation">?</span></span> <span class="token function">ReadAsXml</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Deserialize the contents of the HttpResponse.Body into an object</span>
    <span class="token comment">/// of type T using the built in XmlSerializer</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
    <span class="token return-type class-name">T<span class="token punctuation">?</span></span> <span class="token generic-method"><span class="token function">ReadAsXml</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span><span class="token punctuation">;</span>

    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Deserialize the contents of the HttpResponse.Body into an object</span>
    <span class="token comment">/// of type T using the configured Json serializer</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token comment">/// &lt;typeparam name=&quot;T&quot;&gt;&lt;/typeparam&gt;</span>
    <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
    <span class="token return-type class-name">T<span class="token punctuation">?</span></span> <span class="token generic-method"><span class="token function">ReadAsJson</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token return-type class-name">T<span class="token punctuation">?</span></span> <span class="token generic-method"><span class="token function">Read</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> contentType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/Alba/IScenarioResult.cs#L8-L53" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_iscenarioresult" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Alba v5 makes the old <code>HttpResponseBody</code> obsolete. It&#39;s still there, but the same functionality is readily available on <code>IScenarioResult</code>.</p></div><p>If the existing <em>Scenario</em> assertions aren&#39;t enough to verify your test case, you can work directly against the raw response:</p><!-- snippet: sample_should_say_hello_world_with_raw_objects --><p><a id="snippet-sample_should_say_hello_world_with_raw_objects"></a></p><div class="language-cs"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">should_say_hello_world_with_raw_objects</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> system <span class="token operator">=</span> AlbaHost<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForStartup</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Startup<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> system<span class="token punctuation">.</span><span class="token function">Scenario</span><span class="token punctuation">(</span>_ <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            _<span class="token punctuation">.</span>Get<span class="token punctuation">.</span><span class="token function">Url</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _<span class="token punctuation">.</span><span class="token function">StatusCodeShouldBeOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        response<span class="token punctuation">.</span><span class="token function">ReadAsText</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ShouldBe</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// or you can go straight at the HttpContext</span>
        <span class="token class-name">Stream</span> responseStream <span class="token operator">=</span> response<span class="token punctuation">.</span>Context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>Body<span class="token punctuation">;</span>
        <span class="token comment">// do assertions directly on the responseStream</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/Alba.Testing/Samples/Quickstart.cs#L88-L108" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_should_say_hello_world_with_raw_objects" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>Do note that Alba quietly &quot;rewinds&quot; the <code>HttpContext.Response.Body</code> stream so that you can more readily read and work with the contents.</p><h2 id="customizing-the-system-for-testing"><a class="header-anchor" href="#customizing-the-system-for-testing" aria-hidden="true">#</a> Customizing the System for Testing</h2><p>If you also want to run real HTTP requests through your system in a test harness, you have more opportunities to configure the underlying <a href="https://docs.microsoft.com/en-us/aspnet/core/api/microsoft.aspnetcore.hosting.iwebhostbuilder" target="_blank" rel="noopener noreferrer">IWebHostBuilder</a> like so:</p><!-- snippet: sample_configuration_overrides --><p><a id="snippet-sample_configuration_overrides"></a></p><div class="language-cs"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> stubbedWebService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">StubbedWebService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> Host<span class="token punctuation">.</span><span class="token function">CreateDefaultBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">ConfigureWebHostDefaults</span><span class="token punctuation">(</span>c <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseStartup</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Startup<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// override the environment if you need to</span>
    <span class="token punctuation">.</span><span class="token function">UseEnvironment</span><span class="token punctuation">(</span><span class="token string">&quot;Testing&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">// override service registrations or internal options if you need to</span>
    <span class="token punctuation">.</span><span class="token function">ConfigureServices</span><span class="token punctuation">(</span>s <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        s<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IExternalWebService<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>stubbedWebService<span class="token punctuation">)</span><span class="token punctuation">;</span>
        s<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">PostConfigure</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MvcNewtonsoftJsonOptions<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>o <span class="token operator">=&gt;</span>
            o<span class="token punctuation">.</span>SerializerSettings<span class="token punctuation">.</span>TypeNameHandling <span class="token operator">=</span> TypeNameHandling<span class="token punctuation">.</span>All<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Create the SystemUnderTest</span>
<span class="token class-name"><span class="token keyword">var</span></span> system <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AlbaHost</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">BeforeEach</span><span class="token punctuation">(</span>httpContext <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// do some data setup or clean up before every single test</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">AfterEach</span><span class="token punctuation">(</span>httpContext <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// do any kind of cleanup after each scenario completes</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/Alba.Testing/Samples/Quickstart.cs#L173-L200" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_configuration_overrides" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>A couple notes:</p><ul><li>Alba does not do anything to set the hosting environment, but you can do that yourself against <code>IWebHostBuilder</code></li><li>If you build a <code>AlbaHost</code> with <code>AlbaHost.ForStartup&lt;T&gt;()</code>, it will try to guess at the content root path by the name of assembly that holds the <code>Startup</code> class, but you may need to override that yourself.</li></ul><p>My shop is also using Alba within <a href="http://storyteller.github.io" target="_blank" rel="noopener noreferrer">Storyteller</a> specifications where we use a mix of headless Alba Scenario&#39;s and full HTTP requests for testing.</p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/JasperFx/alba/edit/master/docs/guide/hosting.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>Suggest changes to this page <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/alba/guide/" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>Getting Started</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/alba/guide/xunit" data-v-38ede35f><span class="text" data-v-38ede35f>Integrating with xUnit.Net</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"9fc2b8b5\",\"guide_extensions.md\":\"d68e0b59\",\"guide_hosting.md\":\"3dc25292\",\"guide_index.md\":\"eda5399d\",\"guide_nunit.md\":\"cd7c1684\",\"guide_security.md\":\"8adf4a9d\",\"guide_testserver.md\":\"2d341787\",\"guide_xunit.md\":\"0a13a25f\",\"scenarios_assertions.md\":\"f895ed0e\",\"scenarios_formdata.md\":\"8d9c15ef\",\"scenarios_headers.md\":\"a4c59a38\",\"scenarios_index.md\":\"52206690\",\"scenarios_json.md\":\"6d5f7b46\",\"scenarios_redirects.md\":\"2b61af24\",\"scenarios_setup.md\":\"e12ad57d\",\"scenarios_statuscode.md\":\"857d3f02\",\"scenarios_text.md\":\"9e218c47\",\"scenarios_urls.md\":\"57c036cc\",\"scenarios_xml.md\":\"846bc4d9\"}")</script>
    <script type="module" async src="/alba/assets/app.3865ee6a.js"></script>
  </body>
</html>