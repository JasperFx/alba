<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Before and after actions | Alba</title>
    <meta name="description" content="Supercharged integration testing for ASP.Net Core web services">
    <link rel="stylesheet" href="/alba/assets/style.41ec4b9e.css">
    <link rel="modulepreload" href="/alba/assets/Home.29084b15.js">
    <link rel="modulepreload" href="/alba/assets/AlgoliaSearchBox.9e40c0e7.js">
    <link rel="modulepreload" href="/alba/assets/app.ba9243e9.js">
    <link rel="modulepreload" href="/alba/assets/scenarios_setup.md.3fba0e11.lean.js">
    <link rel="modulepreload" href="/alba/assets/app.ba9243e9.js">
    <meta name="twitter:title" content="Before and after actions | Alba">
    <meta property="og:title" content="Before and after actions | Alba">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/alba/" aria-label="Alba, back to home" data-v-675d8756 data-v-4a583abe><!----> Alba</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/alba/guide/" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://gitter.im/JasperFx/alba?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Gitter | Join Chat <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://github.com/JasperFx/alba" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/alba/guide/" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://gitter.im/JasperFx/alba?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Gitter | Join Chat <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://github.com/JasperFx/alba" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/">Getting Started</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/hosting">Alba Setup</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/xunit">Integrating with xUnit.Net</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/nunit">Integrating with NUnit</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/extensions">Extension Model</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/security">Security Extensions</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/">Scenario Testing</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item active" href="/alba/scenarios/setup">Set up and tear down actions</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/urls">Specifying Urls</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/statuscode">HTTP Status Codes</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/headers">HTTP Headers</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/json">Json Web Services</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/xml">Xml Web Services</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/text">Plain Text Web Services</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/assertions">Custom Assertions</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/redirects">Redirects</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="before-and-after-actions"><a class="header-anchor" href="#before-and-after-actions" aria-hidden="true">#</a> Before and after actions</h1><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>The Before/After actions are <strong>not</strong> additive. The last one specified is the only one executed.</p></div><p>As of Alba 2.0, you can specify actions that run immediately before or after an HTTP request is executed for common setup or teardown work like setting up authentication credentials or tracing or whatever.</p><p>Here&#39;s a sample:</p><!-- snippet: sample_before_and_after --><p><a id="snippet-sample_before_and_after"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">sample_usage</span><span class="token punctuation">(</span><span class="token class-name">AlbaHost</span> system<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Synchronously</span>
    system<span class="token punctuation">.</span><span class="token function">BeforeEach</span><span class="token punctuation">(</span>context <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Modify the HttpContext immediately before each</span>
        <span class="token comment">// Scenario()/HTTP request is executed</span>
        context<span class="token punctuation">.</span>Request<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;trace&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;something&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    system<span class="token punctuation">.</span><span class="token function">AfterEach</span><span class="token punctuation">(</span>context <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// perform an action immediately after the scenario/HTTP request</span>
        <span class="token comment">// is executed</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Asynchronously</span>
    system<span class="token punctuation">.</span><span class="token function">BeforeEachAsync</span><span class="token punctuation">(</span>context <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// do something asynchronous here</span>
        <span class="token keyword">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    system<span class="token punctuation">.</span><span class="token function">AfterEachAsync</span><span class="token punctuation">(</span>context <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// do something asynchronous here</span>
        <span class="token keyword">return</span> Task<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/Alba.Testing/before_and_after_actions.cs#L33-L66" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_before_and_after" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/JasperFx/alba/edit/master/docs/scenarios/setup.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>Suggest changes to this page <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/alba/scenarios/" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>Scenario Testing</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/alba/scenarios/urls" data-v-38ede35f><span class="text" data-v-38ede35f>Specifying Urls</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"6f86947c\",\"guide_extensions.md\":\"730be854\",\"guide_hosting.md\":\"4efd5c56\",\"guide_index.md\":\"51ea9e4a\",\"guide_nunit.md\":\"49995317\",\"guide_security.md\":\"02761bf0\",\"guide_testserver.md\":\"c0c7b150\",\"guide_xunit.md\":\"ab6c070b\",\"scenarios_assertions.md\":\"8882e2bc\",\"scenarios_formdata.md\":\"0cee856e\",\"scenarios_headers.md\":\"188ef2af\",\"scenarios_index.md\":\"51c8a4dd\",\"scenarios_json.md\":\"fc1fbb00\",\"scenarios_redirects.md\":\"7e186fdd\",\"scenarios_setup.md\":\"3fba0e11\",\"scenarios_statuscode.md\":\"5ef92545\",\"scenarios_text.md\":\"b0a343ee\",\"scenarios_urls.md\":\"5cc8556c\",\"scenarios_xml.md\":\"a939679a\"}")</script>
    <script type="module" async src="/alba/assets/app.ba9243e9.js"></script>
  </body>
</html>