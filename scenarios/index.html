<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Scenario Testing | Alba</title>
    <meta name="description" content="Supercharged integration testing for ASP.Net Core web services">
    <link rel="stylesheet" href="/alba/assets/style.41ec4b9e.css">
    <link rel="modulepreload" href="/alba/assets/Home.2139d38b.js">
    <link rel="modulepreload" href="/alba/assets/AlgoliaSearchBox.38b2ae5d.js">
    <link rel="modulepreload" href="/alba/assets/app.14495198.js">
    <link rel="modulepreload" href="/alba/assets/scenarios_index.md.1857a46a.lean.js">
    <link rel="modulepreload" href="/alba/assets/app.14495198.js">
    <meta name="twitter:title" content="Scenario Testing | Alba">
    <meta property="og:title" content="Scenario Testing | Alba">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/alba/" aria-label="Alba, back to home" data-v-675d8756 data-v-4a583abe><!----> Alba</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/alba/guide/" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://gitter.im/JasperFx/alba?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Gitter | Join Chat <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://github.com/JasperFx/alba" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--[--><div class="algolia-search-box" id="docsearch"></div><!--]--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-15acbf05><!--[--><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item" href="/alba/guide/" data-v-b8818f8c>Guide <!----></a></div></div><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://gitter.im/JasperFx/alba?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>Gitter | Join Chat <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><!--]--><!----><div class="item" data-v-15acbf05><div class="nav-link" data-v-15acbf05 data-v-b8818f8c><a class="item isExternal" href="https://github.com/JasperFx/alba" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/">Getting Started</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/hosting">Working with AlbaHost</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/xunit">Integrating with xUnit.Net</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/nunit">Integrating with NUnit</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/extensions">Extension Model</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/guide/security">Security Extensions</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item active" href="/alba/scenarios/">Scenario Testing</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/setup">Set up and tear down actions</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/urls">Specifying Urls</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/statuscode">HTTP Status Codes</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/headers">HTTP Headers</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/json">Json Web Services</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/xml">Xml Web Services</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/text">Plain Text Web Services</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/assertions">Custom Assertions</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/alba/scenarios/redirects">Redirects</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><!-- TODO: make this button accessible --><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="scenario-testing"><a class="header-anchor" href="#scenario-testing" aria-hidden="true">#</a> Scenario Testing</h1><h2 id="writing-your-first-scenario"><a class="header-anchor" href="#writing-your-first-scenario" aria-hidden="true">#</a> Writing your first scenario</h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Alba is not directly coupled to MVC Core in any way and executes requests through your application without any knowledge of the middleware, controllers, or the other mechanisms that may be handling the request in your application.</p></div><p>For the purpose of this sample, let&#39;s say you have a very simple web service application with the following controller endpoint:</p><!-- snippet: sample_MathController --><p><a id="snippet-sample_mathcontroller"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">OperationType</span>
<span class="token punctuation">{</span>
    Add<span class="token punctuation">,</span>
    Subtract<span class="token punctuation">,</span>
    Multiply<span class="token punctuation">,</span>
    Divide
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OperationRequest</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">OperationType</span> Type <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> One <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Two <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OperationResult</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Answer <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Method <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ApiController</span></span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Route</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;[controller]&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MathController</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpGet</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;add/{one}/{two}&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">OperationResult</span> <span class="token function">Add</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> one<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> two<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OperationResult</span>
        <span class="token punctuation">{</span>
            Answer <span class="token operator">=</span> one <span class="token operator">+</span> two
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPut</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">OperationResult</span> <span class="token function">Put</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span><span class="token class-name">OperationRequest</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>Type<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">case</span> OperationType<span class="token punctuation">.</span>Add<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OperationResult</span><span class="token punctuation">{</span>Answer <span class="token operator">=</span> request<span class="token punctuation">.</span>One <span class="token operator">+</span> request<span class="token punctuation">.</span>Two<span class="token punctuation">,</span> Method <span class="token operator">=</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            
            <span class="token keyword">case</span> OperationType<span class="token punctuation">.</span>Multiply<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OperationResult</span><span class="token punctuation">{</span>Answer <span class="token operator">=</span> request<span class="token punctuation">.</span>One <span class="token operator">*</span> request<span class="token punctuation">.</span>Two<span class="token punctuation">,</span> Method <span class="token operator">=</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            
            <span class="token keyword">case</span> OperationType<span class="token punctuation">.</span>Subtract<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OperationResult</span><span class="token punctuation">{</span>Answer <span class="token operator">=</span> request<span class="token punctuation">.</span>One <span class="token operator">-</span> request<span class="token punctuation">.</span>Two<span class="token punctuation">,</span> Method <span class="token operator">=</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            
            <span class="token keyword">default</span><span class="token punctuation">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentOutOfRangeException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">HttpPost</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">OperationResult</span> <span class="token function">Post</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">FromBody</span></span><span class="token punctuation">]</span><span class="token class-name">OperationRequest</span> request<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span>Type<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">case</span> OperationType<span class="token punctuation">.</span>Add<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OperationResult</span><span class="token punctuation">{</span>Answer <span class="token operator">=</span> request<span class="token punctuation">.</span>One <span class="token operator">+</span> request<span class="token punctuation">.</span>Two<span class="token punctuation">,</span> Method <span class="token operator">=</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
                
            <span class="token keyword">case</span> OperationType<span class="token punctuation">.</span>Multiply<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OperationResult</span><span class="token punctuation">{</span>Answer <span class="token operator">=</span> request<span class="token punctuation">.</span>One <span class="token operator">*</span> request<span class="token punctuation">.</span>Two<span class="token punctuation">,</span> Method <span class="token operator">=</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            
            <span class="token keyword">case</span> OperationType<span class="token punctuation">.</span>Subtract<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OperationResult</span><span class="token punctuation">{</span>Answer <span class="token operator">=</span> request<span class="token punctuation">.</span>One <span class="token operator">-</span> request<span class="token punctuation">.</span>Two<span class="token punctuation">,</span> Method <span class="token operator">=</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            
            <span class="token keyword">default</span><span class="token punctuation">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ArgumentOutOfRangeException</span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>Type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/WebApp/Controllers/MathController.cs#L6-L79" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_mathcontroller" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>Back in your test project, the easiest, and probably most common, usage of Alba is to send and verify JSON message bodies to <code>Controller</code> actions. To that end, let&#39;s test the GET method in that controller above by passing a url and verifying the results:</p><!-- snippet: sample_get_json --><p><a id="snippet-sample_get_json"></a></p><div class="language-cs"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">get_happy_path</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> builder <span class="token operator">=</span> Program<span class="token punctuation">.</span><span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Empty</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> system <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">AlbaHost</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Issue a request, and check the results</span>
    <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">await</span> system<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetAsJson</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OperationResult<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;/math/add/3/4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    result<span class="token punctuation">.</span>Answer<span class="token punctuation">.</span><span class="token function">ShouldBe</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/Alba.Testing/using_json_helpers.cs#L21-L34" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_get_json" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>So what just happened in that test? First off, the call to <code>new AlbaHost(IHostBuilder)</code> bootstraps your web application.</p><p>The call to <code>host.GetAsJson&lt;OperationResult&gt;(&quot;/math/add/3/4&quot;)</code> is performing these steps internally:</p><ol><li>Formulate an <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.httprequest?view=aspnetcore-5.0" target="_blank" rel="noopener noreferrer">HttpRequest</a> object that will be passed to the application</li><li>Executes the web request against your application</li><li>Assert in this simple use case that the response status code is <code>200 OK</code></li><li>Read the raw JSON coming off the <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.http.httpresponse?view=aspnetcore-5.0" target="_blank" rel="noopener noreferrer">HttpResponse</a></li><li>Deserialize the raw JSON to the requested <code>OperationResult</code> type using the Json formatter of the running application</li><li>Returns the resulting <code>OperationResult</code></li></ol><p>Alright then, let&#39;s try posting JSON in and examining the JSON out:</p><!-- snippet: sample_post_json_get_json --><p><a id="snippet-sample_post_json_get_json"></a></p><div class="language-cs"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">post_and_expect_response</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> system <span class="token operator">=</span> AlbaHost<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForStartup</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WebApp<span class="token punctuation">.</span>Startup<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OperationRequest</span>
    <span class="token punctuation">{</span>
        Type <span class="token operator">=</span> OperationType<span class="token punctuation">.</span>Multiply<span class="token punctuation">,</span>
        One <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span>
        Two <span class="token operator">=</span> <span class="token number">4</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> result <span class="token operator">=</span> <span class="token keyword">await</span> system<span class="token punctuation">.</span><span class="token function">PostJson</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">&quot;/math&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Receive</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OperationResult<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    result<span class="token punctuation">.</span>Answer<span class="token punctuation">.</span><span class="token function">ShouldBe</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result<span class="token punctuation">.</span>Method<span class="token punctuation">.</span><span class="token function">ShouldBe</span><span class="token punctuation">(</span><span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/Alba.Testing/using_json_helpers.cs#L36-L54" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_post_json_get_json" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>It&#39;s a little more complicated, but the same goal is realized here. Allow the test author to work in terms of the application model objects while still exercising the entire HTTP middleware stack.</p><p>Don&#39;t stop here though, Alba also gives you the ability to declaratively assert on elements of the <code>HttpResponse</code> like expected header values, status codes, and assertions against the response body. In addition, Alba provides a lot of helper facilities to work with the raw <code>HttpResponse</code> data.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>As of Alba V5, the scenario support is no longer hard coded to use Newtonsoft.Json for Json serialization and will instead use the configured Json formatters within your application. Long story short, Alba now supports applications using System.Text.Json as well as Newtonsoft.Json.</p></div><h2 id="testing-hello-world"><a class="header-anchor" href="#testing-hello-world" aria-hidden="true">#</a> Testing Hello, World</h2><p>Now let&#39;s say that you built the obligatory hello world application for <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core shown below:</p><!-- snippet: sample_HelloWorldApp --><p><a id="snippet-sample_helloworldapp"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Startup</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Configure</span><span class="token punctuation">(</span><span class="token class-name">IApplicationBuilder</span> builder<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        builder<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>context <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>Headers<span class="token punctuation">[</span><span class="token string">&quot;content-type&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span><span class="token function">WriteAsync</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/Alba.Testing/Samples/Quickstart.cs#L215-L227" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_helloworldapp" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>We can now use Alba to declare an integration test for our Hello, World application within an <a href="http://xunit.github.io/" target="_blank" rel="noopener noreferrer">xUnit</a> testing project:</p><!-- snippet: sample_should_say_hello_world --><p><a id="snippet-sample_should_say_hello_world"></a></p><div class="language-cs"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">should_say_hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">using</span> <span class="token class-name"><span class="token keyword">var</span></span> host <span class="token operator">=</span> <span class="token keyword">await</span> Program
        <span class="token punctuation">.</span><span class="token function">CreateHostBuilder</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Empty</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token comment">// This extension method is just a shorter version</span>
        <span class="token comment">// of new AlbaHost(builder)</span>
        <span class="token punctuation">.</span><span class="token function">StartAlbaAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// This runs an HTTP request and makes an assertion</span>
    <span class="token comment">// about the expected content of the response</span>
    <span class="token keyword">await</span> host<span class="token punctuation">.</span><span class="token function">Scenario</span><span class="token punctuation">(</span>_ <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        _<span class="token punctuation">.</span>Get<span class="token punctuation">.</span><span class="token function">Url</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _<span class="token punctuation">.</span><span class="token function">ContentShouldBe</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        _<span class="token punctuation">.</span><span class="token function">StatusCodeShouldBeOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/Alba.Testing/Samples/Quickstart.cs#L30-L50" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_should_say_hello_world" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p><p>The sample up above bootstraps the application defined by our <code>Startup</code> and executes a <em>Scenario</em> against the running system. A <em>scenario</em> in Alba defines how the HTTP request should be constructed (the request body, headers, url) and optionally gives you the ability to express assertions against the expected HTTP response.</p><p>Alba comes with plenty of helpers in its <a href="https://www.martinfowler.com/bliki/FluentInterface.html" target="_blank" rel="noopener noreferrer">fluent interface</a> to work with the <code>HttpRequest</code> and <code>HttpResponse</code>, or you can work directly with the underlying <a href="http://ASP.Net" target="_blank" rel="noopener noreferrer">ASP.Net</a> Core objects:</p><!-- snippet: sample_should_say_hello_world_with_raw_objects --><p><a id="snippet-sample_should_say_hello_world_with_raw_objects"></a></p><div class="language-cs"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">should_say_hello_world_with_raw_objects</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> system <span class="token operator">=</span> AlbaHost<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ForStartup</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Startup<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> system<span class="token punctuation">.</span><span class="token function">Scenario</span><span class="token punctuation">(</span>_ <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            _<span class="token punctuation">.</span>Get<span class="token punctuation">.</span><span class="token function">Url</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            _<span class="token punctuation">.</span><span class="token function">StatusCodeShouldBeOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        response<span class="token punctuation">.</span><span class="token function">ReadAsText</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">ShouldBe</span><span class="token punctuation">(</span><span class="token string">&quot;Hello, World!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// or you can go straight at the HttpContext</span>
        <span class="token class-name">Stream</span> responseStream <span class="token operator">=</span> response<span class="token punctuation">.</span>Context<span class="token punctuation">.</span>Response<span class="token punctuation">.</span>Body<span class="token punctuation">;</span>
        <span class="token comment">// do assertions directly on the responseStream</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/alba/blob/master/src/Alba.Testing/Samples/Quickstart.cs#L88-L108" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_should_say_hello_world_with_raw_objects" title="Start of snippet">anchor</a></sup><!-- endSnippet --></p></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/JasperFx/alba/edit/master/docs/scenarios/index.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>Suggest changes to this page <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/alba/guide/security" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>Security Extensions</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/alba/scenarios/setup" data-v-38ede35f><span class="text" data-v-38ede35f>Set up and tear down actions</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"9aa11f58\",\"guide_extensions.md\":\"8a70226f\",\"guide_hosting.md\":\"2016cf4f\",\"guide_index.md\":\"75f82bce\",\"guide_nunit.md\":\"59ddaae5\",\"guide_security.md\":\"203c9479\",\"guide_testserver.md\":\"b2e80ed9\",\"guide_xunit.md\":\"de739cf5\",\"scenarios_assertions.md\":\"2f5125da\",\"scenarios_formdata.md\":\"bd98d080\",\"scenarios_headers.md\":\"b81a9d0c\",\"scenarios_index.md\":\"1857a46a\",\"scenarios_json.md\":\"1eedd308\",\"scenarios_redirects.md\":\"dde9a811\",\"scenarios_setup.md\":\"24dec472\",\"scenarios_statuscode.md\":\"9d83943b\",\"scenarios_text.md\":\"bf3ad486\",\"scenarios_urls.md\":\"79ecc97a\",\"scenarios_xml.md\":\"1acd35e4\"}")</script>
    <script type="module" async src="/alba/assets/app.14495198.js"></script>
  </body>
</html>